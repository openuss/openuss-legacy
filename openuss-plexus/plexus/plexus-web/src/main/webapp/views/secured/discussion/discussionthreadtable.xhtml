<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:plexus="http://www.openuss.org/plexus/jsf"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:o="http://www.openuss.org/jsfcontrols"
	  xmlns:s="http://www.openuss.org/jsf-security"      
      xmlns:c="http://java.sun.com/jstl/core">
      
    <plexus:dataTable id="discussionsThreadTable" label="#{msg.discussion_main_header}" 
    	value="views$secured$discussion$discussionthread.data" var="post" rows="10">
      
		<t:column>
			<h:graphicImage styleClass="userphoto"
				value="/files?fileid=#{post.submitterPicture}"
				title="#{post.submitter}" rendered="#{not empty post.submitterPicture}" />
			<h:graphicImage styleClass="userphoto"
				value="/images/icons/no_pic.gif" 
				alt="#{msg.user_profile_no_image}"
				title="#{msg.user_profile_no_image}"
				rendered="#{empty post.submitterPicture}" />
		</t:column>
		<t:column>
			<plexus:commandSortHeader columnName="author"> #{msg['discussion_thread_column_author']} </plexus:commandSortHeader>
			<h:outputText value="#{post.submitter}"></h:outputText>			
		</t:column>
		<t:column>
			<plexus:commandSortHeader columnName="text"> #{msg['discussion_thread_column_message']} </plexus:commandSortHeader>
			<div class="content_font_normal">
				<h:outputText value="#{post.created}" styleClass="content_font_normal">	
					<f:convertDateTime type="both" timeZone="#{visit.timeZone}"/>
				</h:outputText>
				<h:outputText value="#{post.title}" styleClass="header_font_normal" />
				<s:acl domainObject="#{enrollment}" hasPermission="#{ACL.ASSIST}" >
					<plexus:command bean="#{views$secured$discussion$discussionthread}"
						action="removePost" label="#{msg['discussion_thread_remove_post']}"
						title="#{msg['discussion_thread_remove_post']}"
						styleClass="button_remove"/>				
				</s:acl>
				<plexus:command bean="#{views$secured$discussion$discussionthread}"
					action="editPost" label="#{msg['discussion_thread_edit_post']}"
					title="#{msg['discussion_thread_edit_post']}"
					styleClass="button_remove"/>
				<plexus:command bean="#{views$secured$discussion$discussionthread}"
					action="quote" label="#{msg['discussion_thread_quote']}"
					title="#{msg['discussion_thread_quote']}"
					styleClass="button_remove"/>
			</div>
			<hr />
			<div class="content_font_normal">
				<h:outputText value="#{post.text}" escape="false"/>
			</div>	
			<h:outputText value="#{msg.discussion_post_edited} #{post.editor} #{msg.discussion_post_edited2} #{post.lastModification}" rendered="#{post.isEdited}">
				<f:convertDateTime type="both" timeZone="#{visit.timeZone}"/>
			</h:outputText>
			<hr />
			<f:subview rendered="#{!(empty post.attachments)}">
					<div class="content_font_normal">
						<t:dataList 
							var="attachment" 
							value="#{post.attachments}" >
							<o:link value="/files/#{attachment.fileName}" rendered="#{!empty attachment.id}">
								<f:param value="#{attachment.id}" name="fileid" />
								<h:graphicImage	value="/images/filetypes/#{attachment.extension}.gif" />
						  		#{attachment.fileName} 
						  	</o:link> 
							<br/>	
						</t:dataList>
					</div>
				</f:subview>	
		</t:column>		
	</plexus:dataTable>      
</ui:composition>
