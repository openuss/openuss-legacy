<?xml version="1.0" encoding="UTF-8"?>
<web-app version="2.4" xmlns="http://java.sun.com/xml/ns/j2ee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd">
	<display-name>openuss-plexus</display-name>
	
	<!-- - - - - - - - - - - - - - - - - - - - - - - - 
	     Spring ContextLoader Configuration
	- - - - - - - - - - - - - - - - - - - - - - - - - -->	
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>
			classpath*:applicationContext.xml,
			classpath*:applicationContext-cache.xml,
			classpath*:applicationContext-entities.xml,
			<!-- classpath*:applicationContext-services.xml, -->
			<!-- classpath*:applicationContext-localDataSource.xml, -->
			classpath*:applicationContext-dataSource.xml,
			classpath*:applicationContext-legacy.xml,
			<!--classpath*:applicationContext-beans.xml,-->
			classpath*:applicationContext-adapters.xml,
			classpath*:applicationContext-commands.xml,
			classpath*:applicationContext-messaging.xml,
			classpath*:applicationContext-mailinglist.xml,
			classpath*:applicationContext-lucene.xml,
			classpath*:applicationContext-resources.xml,
			/WEB-INF/security.xml,
			/WEB-INF/actions.xml,
			/WEB-INF/openuss-context.xml,
			/WEB-INF/views-controller-map.xml
		</param-value>
	</context-param>

	<!-- - - - - - - - - - - - - - - - - - - - - - - - 
	     Facelets Configuration
	- - - - - - - - - - - - - - - - - - - - - - - - - -->	
	<context-param>
		<param-name>facelets.DEVELOPMENT</param-name>
		<param-value>true</param-value>
	</context-param>

	<context-param>
		<param-name>facelets.REFRESH_PERIOD</param-name>
		<param-value>2</param-value>
	</context-param>

	<context-param>
		<param-name>facelets.BUFFER_SIZE</param-name>
		<param-value>500</param-value>
	</context-param>

	<context-param>
		<param-name>facelets.LIBRARIES</param-name>
		<param-value>/WEB-INF/taglibs/shale.taglib.xml;/WEB-INF/taglibs/tomahawk.taglib.xml;/WEB-INF/taglibs/tomahawk-sandbox.taglib.xml;/WEB-INF/taglibs/plexus.taglib.xml</param-value>
	</context-param>

	<context-param>
		<param-name>facelets.RESOURCE_RESOLVER</param-name>
		<param-value>org.openuss.web.facelets.ThemeAwareResourceResolver</param-value>
	</context-param>

	<!-- - - - - - - - - - - - - - - - - - - - - - - - 
	   JavaServer Faces Configuration
	- - - - - - - - - - - - - - - - - - - - - - - - - -->	

	<context-param>
		<param-name>javax.faces.DEFAULT_SUFFIX</param-name>
		<param-value>.xhtml</param-value>
	</context-param>

	<context-param>
		<param-name>javax.faces.STATE_SAVING_METHOD</param-name>
		<param-value>server</param-value>
	</context-param>
	
	<context-param>
    	<param-name>javax.faces.CONFIG_FILES</param-name>
    	<param-value>/WEB-INF/faces-navigation.xml,/WEB-INF/faces-managed-beans.xml</param-value>
	</context-param>	

	<context-param>
		<param-name>com.sun.faces.validateXml</param-name>
		<param-value>true</param-value>
	</context-param>
	
	<context-param>
		<param-name>com.sun.faces.verifyObjects</param-name>
		<param-value>true</param-value>
	</context-param>
	
	<!-- - - - - - - - - - - - - - - - - - - - - - -
	   Tomahawk and MyFaces Configuration 
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	<context-param>
		<param-name>org.apache.myfaces.ALLOW_JAVASCRIPT</param-name>
		<param-value>true</param-value>
	</context-param>
	
	<context-param>
		<param-name>org.apache.myfaces.DETECT_JAVASCRIPT</param-name>
		<param-value>false</param-value>
	</context-param>
	
	<context-param>
		<param-name>org.apache.myfaces.PRETTY_HTML</param-name>
		<param-value>true</param-value>
	</context-param>
	
	<context-param>
		<param-name>org.apache.myfaces.AUTO_SCROLL</param-name>
		<param-value>true</param-value>
	</context-param>
	
	<!-- 
	<context-param>
		<param-name>org.apache.myfaces.ADD_RESOURCE_CLASS</param-name>
		<param-value>org.apache.myfaces.component.html.util.StreamingAddResource</param-value>
	</context-param>
	 -->
	
	<context-param>
		<param-name>org.apache.myfaces.COMPRESS_STATE_IN_SESSION</param-name>
		<param-value>true</param-value>
	</context-param>	
	
	<context-param>
		<param-name>org.apache.myfaces.SERIALIZE_STATE_IN_SESSION</param-name>
		<param-value>true</param-value>
	</context-param>
	
	<context-param>
		<param-name>org.apache.myfaces.VALIDATE</param-name>
		<param-value>true</param-value>
	</context-param>

	<!-- - - - - - - - - - - - - - - - - - - - - -
       JSTL Configuration  
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	 
	<context-param>
		<param-name>javax.servlet.jsp.jstl.fmt.localizationContext</param-name>
		<param-value>resources</param-value>
	</context-param>

	<!-- - - - - - - - - - - - - - - - - - - - - -
       FCK-Faces Configuration  
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	 
	<context-param>
		<param-name>org.fckfaces.CUSTOM_CONFIGURATIONS_PATH</param-name>
		<param-value>/js/fckconfig.js</param-value>
	</context-param>

	<!-- - - - - - - - - - - - - - - - - - - - - -
       OpenUSS Plexus Configuration  
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	<context-param>
		<param-name>org.openuss.servlet.node</param-name>
		<param-value>plexus_node_one</param-value>
	</context-param>
	 
	<context-param>
		<param-name>org.openuss.web.themes.DEFAULT_THEME_ID</param-name>
		<param-value>plexus</param-value>
	</context-param>
	

	<!-- - - - - - - - - - - - - - - - - - - - - -
	   Shale Configuration
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	
	<context-param>
		<param-name>org.apache.shale.view.EXCEPTION_DISPATCH_PATH</param-name>
		<param-value>/views/errors/error.faces</param-value>
	</context-param>
	
	<!-- - - - - - - - - - - - - - - - - - - - - -
	   Log4j ConfigLocation Configuration
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	
	<context-param>
		<param-name>log4jConfigLocation</param-name>
		<param-value>/WEB-INF/log4j.properties</param-value>
	</context-param>
	
	<context-param>
		<param-name>log4jExposeWebAppRoot</param-name>
		<param-value>false</param-value>
	</context-param>

	<!-- - - - - - - - - - - - - - - - - - - - - - -
	   Session In View Filter
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	<filter>
		<filter-name>EarlyWarningFilter</filter-name>
		<filter-class>org.openuss.web.servlets.EarlyWarningFilter</filter-class>
	</filter>
	
	<filter>
		<filter-name>openSessionInViewFilter</filter-name>
		<filter-class>org.springframework.orm.hibernate3.support.OpenSessionInViewFilter</filter-class>
	</filter>
	
	<filter-mapping>
		<filter-name>EarlyWarningFilter</filter-name>
		<url-pattern>/*</url-pattern>
	</filter-mapping>
    
	<filter-mapping>
		<filter-name>openSessionInViewFilter</filter-name>
		<url-pattern>*.faces</url-pattern>
	</filter-mapping>

	<filter-mapping>
		<filter-name>openSessionInViewFilter</filter-name>
		<url-pattern>/files/*</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>

	<filter-mapping>
		<filter-name>openSessionInViewFilter</filter-name>
		<url-pattern>/zips/*</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>

	<filter-mapping>
		<filter-name>openSessionInViewFilter</filter-name>
		<url-pattern>/chat/*</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>

	<!-- - - - - - - - - - - - - - - - - - - - - - -
	   Shale Filter
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	<filter>
		<filter-name>shale</filter-name>
		<filter-class>org.apache.shale.application.faces.ShaleApplicationFilter</filter-class>
	</filter>
    
	<filter-mapping>
		<filter-name>shale</filter-name>
		<url-pattern>*.faces</url-pattern>
	</filter-mapping>
    
	<!-- - - - - - - - - - - - - - - - - - - - - -
	   Acegi Security Filter
	- - - - - - - - - - - - - - - - - - - - - - - - -->

	<filter>
		<filter-name>Acegi Security Chain Filter</filter-name>
		<filter-class>
			org.acegisecurity.util.FilterToBeanProxy
		</filter-class>
		<init-param>
			<param-name>targetBean</param-name>
			<param-value>securityFilterChainProxy</param-value>
		</init-param>
	</filter>
	
	<filter-mapping>
		<filter-name>Acegi Security Chain Filter</filter-name>
		<url-pattern>*.faces</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>
	
	<filter-mapping>
		<filter-name>Acegi Security Chain Filter</filter-name>
		<url-pattern>/files/*</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>

	<filter-mapping>
		<filter-name>Acegi Security Chain Filter</filter-name>
		<url-pattern>/zips/*</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>

	<filter-mapping>
		<filter-name>Acegi Security Chain Filter</filter-name>
		<url-pattern>/chat/*</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>

	<filter-mapping>
		<filter-name>Acegi Security Chain Filter</filter-name>
		<url-pattern>*.xhtml</url-pattern>
		<dispatcher>FORWARD</dispatcher>
		<dispatcher>REQUEST</dispatcher>
	</filter-mapping>

	<!-- - - - - - - - - - - - - - - - - - - - - -
	   MyFaces Extensions Filter
	- - - - - - - - - - - - - - - - - - - - - - - - -->
	<filter>
		<filter-name>MyFacesExtensionsFilter</filter-name>
		<filter-class>org.apache.myfaces.webapp.filter.ExtensionsFilter</filter-class>
		<init-param>
			<param-name>uploadMaxFileSize</param-name>
			<param-value>100M</param-value>
		</init-param>
		<init-param>
			<param-name>uploadThresholdSize</param-name>
			<param-value>256k</param-value>
		</init-param>
		<init-param>
			<param-name>uploadRepositoryPath</param-name>
			<param-value>/temp</param-value>
		</init-param>
	</filter>
	
	<filter-mapping>
		<filter-name>MyFacesExtensionsFilter</filter-name>
		<url-pattern>*.faces</url-pattern>
	</filter-mapping>
	
	<filter-mapping>
		<filter-name>MyFacesExtensionsFilter</filter-name>
		<url-pattern>/faces/*</url-pattern>
	</filter-mapping>    
	
	<!-- - - - - - - - - - - - - - - - - - - - - -
	   Servlet Listener
	- - - - - - - - - - - - - - - - - - - - - - - - -->	

	<listener>
		<listener-class>
			org.springframework.web.util.Log4jConfigListener
		</listener-class>
	</listener>
	
	<listener>
		<listener-class>
			org.springframework.web.context.ContextLoaderListener
		</listener-class>
	</listener>
	
	<listener>
		<listener-class>
			org.openuss.web.application.StartupServletContextListener
		</listener-class>
	</listener>
	
	<listener>
		<listener-class>
			org.apache.myfaces.webapp.StartupServletContextListener
		</listener-class>
	</listener>

	<listener>
		<listener-class>
			org.apache.commons.chain.web.ChainListener
		</listener-class>
	</listener>

	<listener>
		<listener-class>
			org.openuss.web.servlets.ActiveSessionCounter
		</listener-class>
	</listener>
	
	<!-- - - - - - - - - - - - - - - - - - - - - - -
	   Servlets
	- - - - - - - - - - - - - - - - - - - - - - - - -->	
	<servlet>
		<servlet-name>dispatcher</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet
		</servlet-class>
		<load-on-startup>1</load-on-startup>
	</servlet>
	
	<servlet>
		<servlet-name>DocumentServlet</servlet-name>
		<servlet-class>org.openuss.web.servlets.DocumentServlet</servlet-class>
		<load-on-startup>3</load-on-startup>
	</servlet>
	
	<servlet>
		<servlet-name>ZipDocumentServlet</servlet-name>
		<servlet-class>org.openuss.web.servlets.ZipDocumentServlet</servlet-class>
		<load-on-startup>4</load-on-startup>
	</servlet>
	
	<servlet>
		<servlet-name>Faces Servlet</servlet-name>
		<servlet-class>javax.faces.webapp.FacesServlet</servlet-class>
		<load-on-startup>2</load-on-startup>
	</servlet>
	
	<servlet>
		<servlet-name>FCKFaces</servlet-name>
		<servlet-class>org.fckfaces.util.Servlet</servlet-class>
	</servlet>
	
	<servlet>
		<servlet-name>Chat Servlet</servlet-name>
		<servlet-class>org.openuss.web.servlets.ChatServlet</servlet-class>
		<load-on-startup>0</load-on-startup>
	</servlet>
	
<!--
	<servlet>
	    <servlet-name>Jenia internal servlet</servlet-name>
    	<servlet-class>org.jenia.faces.util.Servlet</servlet-class>
	    <load-on-startup>2</load-on-startup>
	</servlet>
-->	
	<servlet-mapping>
		<servlet-name>DocumentServlet</servlet-name>
		<url-pattern>/files/*</url-pattern>
	</servlet-mapping>

	<servlet-mapping>
		<servlet-name>ZipDocumentServlet</servlet-name>
		<url-pattern>/zips/*</url-pattern>
	</servlet-mapping>

	<servlet-mapping>
		<servlet-name>Chat Servlet</servlet-name>
		<url-pattern>/chat/*</url-pattern>
	</servlet-mapping>
	
	<servlet-mapping>
		<servlet-name>Faces Servlet</servlet-name>
		<url-pattern>*.faces</url-pattern>
	</servlet-mapping>
	
	<servlet-mapping>
		<servlet-name>FCKFaces</servlet-name>
		<url-pattern>/fckfaces/*</url-pattern>
	</servlet-mapping>
	
	<servlet-mapping>
		<servlet-name>dispatcher</servlet-name>
		<url-pattern>/rss/*</url-pattern>
	</servlet-mapping>
	
<!--
	<servlet-mapping>
	    <servlet-name>Jenia internal servlet</servlet-name>
	    <url-pattern>/jenia4faces/*</url-pattern>
	</servlet-mapping>
-->	
	
	<welcome-file-list>
		<welcome-file>index.jsp</welcome-file>
		<welcome-file>index.html</welcome-file>
	</welcome-file-list>
	
 	<error-page>
		<error-code>404</error-code>
		<location>/views/errors/404.faces</location>
	</error-page>
	
	<error-page>
		<error-code>403</error-code>
		<location>/views/errors/403.faces</location>
	</error-page>
	

<!-- 
	<login-config>
		<auth-method>FORM</auth-method>
		<realm-name>plexus</realm-name>
		<form-login-config>
			<form-login-page>/views/login.faces</form-login-page>
			<form-error-page>/views/loginfailed.faces</form-error-page>
		</form-login-config>
	</login-config>
 -->
	
	<!-- Describe a DataSource -->
	<resource-ref>
		<description>
			Resource reference to a factory for java.sql.Connection
			instances that may be used for talking to a particular
			database that is configured in the context.xml file of Tomcat.
		</description>
		<res-ref-name>jdbc/openuss</res-ref-name>
		<res-type>javax.sql.DataSource</res-type>
		<res-auth>Container</res-auth>
	</resource-ref>
</web-app>
