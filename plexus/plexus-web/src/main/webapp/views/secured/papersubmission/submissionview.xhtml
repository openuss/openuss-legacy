<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:o="http://www.openuss.org/jsfcontrols"
      xmlns:s="http://www.openuss.org/jsf-security"      
      xmlns:c="http://java.sun.com/jstl/core"      
      xmlns:plexus="http://www.openuss.org/plexus/jsf">
      
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title><ui:insert name="title"/></title>
        <link href="../../css/openuss.css" rel="stylesheet" type="text/css" media="screen,screen" />
        <!-- css-Datei mit Farbdefinitionen der Rubrik -->
        <link href="../../css/openuss-typo.css" rel="stylesheet" type="text/css" media="screen" />
    </head>

    <body>      
    <!-- text above will be ignored -->
    <ui:composition template="/views/layout/layout.xhtml">
        <!--  TODO: change to right permission -->
        <!--  s:acl domainObject="#{instituteInfo}" hasPermission="#{ACL.MANAGE_COURSE_TYPES}" ifNot="error"/ -->

        <ui:define name="title"><h:outputText value="#{msg.course_main_title} - #{courseInfo.shortcut}"/></ui:define>
        
        <ui:define name="navigation">
            <ui:include src="/views/commons/navigation/course.xhtml" />
        </ui:define>
        
        <ui:define name="content">
            <h:form id="submissionsTableView">
                <s:acl domainObject="#{courseInfo}" hasPermission="#{ACL.ASSIST}"> 
                    <!-- Assitant-view -->
	                <plexus:dataTable   
				        id="submissions" 
				        label="#{msg['papersubmission_submissionstable_header']}" 
				        value="views$secured$papersubmission$submissionview.dataSubmissions" 
				        columnClasses="col_min_center, col_min_center, col_max_center, col_commands"
				        var="bean" 
				        rows="20">
				        
				        <t:column>
				            <h:selectBooleanCheckbox value="#{papersubmission_submission_selection.map[bean]}"/>
				        </t:column>
				        
				        <plexus:column header="#{msg.documents_main_column_type}"> 
							<h:graphicImage value="/images/filetypes/folder.gif"/>
						</plexus:column>
				   
				        <t:column>
				        	<plexus:commandSortHeader columnName="submittersname"> #{msg['documents_main_column_name']} </plexus:commandSortHeader>
				            <h:commandLink action="#{views$secured$papersubmission$submissionview.selectSubmission}" styleClass="command">
									<h:outputText value="#{bean.displayName}"/>
							</h:commandLink>
				            
				        </t:column>
				        
				       
				        <t:column>
				        	<plexus:commandSortHeader columnName="submissionstatus">#{msg.papersubmission_colheader_status}</plexus:commandSortHeader> 
				            <h:graphicImage value="/images/papersubmission/status#{bean.submissionStatus}.png"/>
				            <h:outputText value="&#160;#{msg.papersubmission_submission_status_ok}" rendered="#{bean.submissionStatus.value == 1}"/>
							<h:outputText value="&#160;#{msg.papersubmission_submission_status_late}" rendered="#{bean.submissionStatus. value == 2}"/>
							<h:outputText value="&#160;#{msg.papersubmission_submission_status_missing}" rendered="#{bean.submissionStatus.value == 3}"/>
				        </t:column>
				        
				    			      
				        
				    </plexus:dataTable>
				
					<o:block>
	                    <h:commandButton 
	                        id="downloadFile"
	                        action="#{views$secured$papersubmission$submissionview.downloadSubmission}" 
	                        value="#{msg.papersubmission_command_download}" 
	                        title="#{msg.papersubmission_command_download_hint}"
	                        styleClass="button_big"/> 
	                    <h:commandButton 
	                        id="downloadAllFiles"
	                        action="#{views$secured$papersubmission$submissionview.downloadAllSubmissions}" 
	                        value="#{msg.papersubmission_command_download_all}" 
	                        title="#{msg.papersubmission_command_download_all_hint}"
	                        styleClass="button_big"/>
	                    <h:commandButton 
	                        id="downloadInTimeFiles"
	                        action="#{views$secured$papersubmission$submissionview.downloadInTimeSubmissions}" 
	                        value="#{msg.papersubmission_command_download_in_time}" 
	                        title="#{msg.papersubmission_command_download_in_time_hint}"
	                        styleClass="button_big"/>
	                </o:block>
                   
                </s:acl>
                
                <s:acl domainObject="#{courseInfo}" hasNotPermission="#{ACL.ASSIST}">
	                <!-- Student-view -->
	                <plexus:dataTable   
	                    id="submissionfiles" 
	                    label="#{msg['papersubmission_submissionfilestable_header']}" 
	                    value="views$secured$papersubmission$submissionview.dataSubmissionFiles" 
	                    columnClasses="col_min_center, col_filetype, col_max_left, col_filesize, col_date, col_date, col_commands"
	                    var="bean" 
	                    rows="20">  
	                    
	                    <t:column>
				            <f:facet name="header">
				                <h:selectBooleanCheckbox 
				                    immediate="true" 
				                    onchange="this.form.submit();" 
				                    onclick="this.form.submit();" 
				                    value="#{papersubmission_submission_selection.state}" 
				                    valueChangeListener="#{papersubmission_submission_selection.switchSelection}"/>
				            </f:facet>
				            <h:selectBooleanCheckbox value="#{papersubmission_submission_selection.map[bean]}"/> 
				        </t:column> 
				        
	                    <t:column> 
				            <plexus:commandSortHeader columnName="extension"> #{msg['documents_main_column_type']} </plexus:commandSortHeader>
				            <h:graphicImage value="/images/filetypes/#{bean.extension}.gif" onError="this.value = /images/filetypes/default.gif"/>
				        </t:column>
	               
	                    <t:column>
	                        <plexus:commandSortHeader columnName="name">#{msg.papersubmission_colheader_name}</plexus:commandSortHeader> 
	                              				
            				<o:link value="/files/#{bean.fileName}" title="#{bean.description}">
								<f:param value="#{bean.id}" name="fileid" />
								<h:outputText value="#{bean.name}"/>
							</o:link>
	                    </t:column>
	                    
	                    
	                    
	                    <t:column>
	                        <plexus:commandSortHeader columnName="size">#{msg.papersubmission_colheader_size}</plexus:commandSortHeader> 
	                        <h:outputText value="#{bean.sizeAsString}"/>
	                    </t:column>
	                    
	                    <t:column>
	                        <plexus:commandSortHeader columnName="created">#{msg.papersubmission_colheader_createdate}</plexus:commandSortHeader> 
	                        <h:outputText value="#{bean.created}">
	                        	<f:convertDateTime type="both" timeZone="#{visit.timeZone}"/>
	                        </h:outputText>
	                    </t:column>
	                    
	                    <t:column>
	                        <plexus:commandSortHeader columnName="modified">#{msg.papersubmission_colheader_changedate}</plexus:commandSortHeader> 
	                        <h:outputText value="#{bean.modified}">
	                        	<f:convertDateTime type="both" timeZone="#{visit.timeZone}"/>
	                        </h:outputText>
	                    </t:column>
	                    
						<plexus:column header="#{msg.documents_main_column_actions}">
							<plexus:command 
							    bean="#{views$secured$papersubmission$submissionview}"
								action="editFolderEntry" 
								label="#{msg.documents_main_button_change}" 
								title="#{msg.documents_main_button_change}"
								styleClass="icon_edit"/>
						</plexus:column>
					</plexus:dataTable> 
				                
	                <o:block>
	                    <h:commandButton 
					    id="download"
						action="#{views$secured$papersubmission$submissionview.download}" 
						value="#{msg.documents_main_button_download}" 
						title="#{msg.documents_main_button_download}"
						styleClass="button_add"/>
						
						<h:commandButton 
					    id="addZip"
						action="papersubmission_add_zip" 
						value="#{msg.documents_main_button_zip}" 
						title="#{msg.documents_main_button_zip}"
						styleClass="button_add"/>
						
	                    <h:commandButton 
                        id="addFile"
                        action="#{views$secured$papersubmission$submissionview.addFile}" 
                        value="#{msg.documents_main_button_newfile}" 
                        title="#{msg.papersubmission_command_addfile_hint}"
                        styleClass="button_add"/> 
	                        
	                    <h:commandButton 
					    id="delete"
						action="#{views$secured$papersubmission$submissionview.delete}" 
						value="#{msg.documents_main_button_delete}" 
						styleClass="button_add"/>
	                        
	                    
	                </o:block>   
	                
	            </s:acl>
            </h:form>	        
        </ui:define>
    </ui:composition>
    <!-- text above will be ignored -->
    </body>
</html>