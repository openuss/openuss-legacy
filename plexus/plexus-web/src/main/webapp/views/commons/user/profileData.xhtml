<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:o="http://www.openuss.org/jsfcontrols"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:fck="http://www.fck-faces.org/fck-faces"
	xmlns:s="http://www.openuss.org/jsf-security">
		<br />
		<h:outputText value="#{msg['user_profile_login_header']}" styleClass="header_font_normal" />
		<o:input id="username" forceId="true" entity="user" property="username" required="true">
			<f:validator validatorId="usernameNotExistValidator" />
		</o:input>
		<o:input id="email" forceId="true" entity="user" property="email" required="true">
			<t:validateEmail />
			<f:validator validatorId="uniqueEmailValidator" />
		</o:input>
		<s:authorize ifNotGranted="ROLE_USER">
			<o:input id="password" forceId="true" entity="user" property="password" required="true"
				type="password" redisplay="false">
				<f:validateLength minimum="5" />
			</o:input>
			<h:outputLabel value="#{msg.user_passwordconfirm}"
				for="confirmPassword" styleClass="field_label" />
			<h:inputSecret id="confirmPassword" forceId="true" styleClass="field" required="true"
				redisplay="false">
				<t:validateEqual for="password" />
			</h:inputSecret>
			<h:message for="confirmPassword" styleClass="field_error" />
		</s:authorize>
		<s:authorize ifAllGranted="ROLE_USER" rendered="#{not empty user.id}"><br />
			<t:commandButton id="newPassword" forceId="true" action="secure_password_change" value="#{msg.user_new_password}" styleClass="button_save"/><br />
		</s:authorize>

	<!-- public profile information -->
		<br />
		<h:outputText value="#{msg.profile_public_header}" styleClass="header_font_normal"/> <br />
		<h:outputText value="#{msg.profile_public_explain}" styleClass="content_font_normal"/>								
		<o:input id="firstName" forceId="true" entity="user" property="firstName" maxlength="100" required="true"/>
		<o:input id="lastName" forceId="true" entity="user" property="lastName" maxlength="100" required="true"/>
		<o:input id="title" forceId="true" entity="user" property="title" maxlength="100"/>
		<o:input id="profession" forceId="true" entity="user" property="profession" maxlength="100"/>
		
	<!-- adress information -->
		<br />
		<h:outputText value="#{msg.profile_address_header}" styleClass="header_font_normal"/> <br />
		<o:input id="address" forceId="true" entity="user" property="address" maxlength="100" required="true"/>
		<o:input id="postcode" forceId="true" entity="user" property="postcode" maxlength="50" required="true"/>
		<o:input id="city" forceId="true" entity="user" property="city" maxlength="100" required="true"/>
		<o:input id="country" forceId="true" entity="user" property="country" maxlength="100" required="false"/>
		<o:input id="telephone" forceId="true" entity="user" property="telephone" maxlength="100"/>
	
	<!-- hidden profile information -->
		<br />
		<h:outputText value="#{msg.profile_hidden_header}" styleClass="header_font_normal"/> <br/> 
		<h:outputText value="#{msg.profile_hidden_explain}" styleClass="content_font_normal"/>
		<o:input id="ageGroup" forceId="true" entity="user" property="ageGroup" maxlength="50"/>
		<o:input id="matriculation" forceId="true" entity="user" property="matriculation" maxlength="50"/>
		<o:input id="studies" forceId="true" entity="user" property="studies" maxlength="50"/>
		<o:input id="smsEmail" forceId="true" entity="user" property="smsEmail" maxlength="100">
			<h:outputText value="#{msg.user_smsemail_explain}" styleClass="content_font_normal" />
			<t:validateEmail/>
		</o:input>
	
	<br />
	<h:outputText value="#{msg['user_profile_preferences_header']}" styleClass="header_font_normal" />
	<h:outputLabel value="#{msg.user_locale}" for="languageSelect" styleClass="field_label"/>
	<t:selectOneListbox id="languageSelect" forceId="true" size="1" styleClass="pulldown" value="#{user.locale}">
	    <f:selectItems value="#{visit.supportedLocaleItems}"/>
	</t:selectOneListbox>
	<h:outputLabel value="#{msg.user_timezone}" for="timeZoneSelect" styleClass="field_label"/>
	<t:selectOneListbox id="timeZoneSelect" forceId="true" size="1" styleClass="pulldown" value="#{user.timezone}" >
	    <f:selectItems value="#{visit.supportedTimeZoneItems}"/>
	</t:selectOneListbox>

	<br />
	<!-- Newsletter Settings -->
	<br />
	<h:outputText value="#{msg.profile_newsletter_settings_header}" styleClass="header_font_normal"/> <br/> 
	<h:outputText value="#{msg.profile_newsletter_settings_explain}" styleClass="content_font_normal"/>
	<br />
	<o:input entity="user" forceId="true" property="newsletterSubscriptionEnabled" required="false"/>
	<o:input entity="user" forceId="true" property="discussionSubscriptionEnabled" required="false" /> 
	<br />	
	<s:authorize ifAllGranted="ROLE_USER">
		<!-- visibility -->
			<br />
			<h:outputText value="#{msg.profile_visibility_config}" styleClass="header_font_normal" /><br />
			<o:input id="telephonePublic" forceId="true" entity="user" property="telephonePublic"/>
			<o:input id="addressPublic" forceId="true" entity="user" property="addressPublic" required="false" /> 
			<o:input id="emailPublic" forceId="true" entity="user" property="emailPublic"/>

		<!-- photo -->
			<br />
			<h:outputText value="#{msg.profile_personal_header}" styleClass="header_font_normal" /><br />					

			<h:outputLabel id="avatarSelectLabel" value="${msg.user_profile_image}" for="avatarSelect" styleClass="fieldLabel"/>
			<h:panelGrid columns="2">
				<h:panelGroup>
					
					<c:if test="#{not empty user.imageId}">
						<h:graphicImage styleClass="userphoto"
							rendered="${not empty user.imageId}"
							value="/files?fileid=#{user.imageId}"
							alt="#{user.firstName} #{user.lastName}"
							title="#{user.firstName} #{user.lastName}"/> 
						&#160;
				  		<t:commandLink 
				  			id="removeImage" forceId="true"
				  			actionListener="#{views$secured$user$profile.removeImage}" 
				  			immediate="true" 
				  			title="#{msg.user_profile_command_remove_image}">
				  			<h:graphicImage value="/images/icons/remove.gif" alt="delete"/>
				  		</t:commandLink>
					</c:if>
							
					<c:if test="#{empty user.imageId}">
						<h:graphicImage 
							styleClass="userphoto" 
							value="/images/icons/no_pic.gif" 
							alt="#{msg.user_profile_no_image}" 
							title="#{msg.user_profile_no_image}"/>
					</c:if>
				</h:panelGroup>
		
				<h:panelGroup>
					<h:outputLabel value="#{msg.user_profile_image}" for="image"/>
					<br/>
				  	<t:inputFileUpload id="image" forceId="true" storage="file" accept="image/*" immediate="true" styleClass="uploadField" >
		  				<f:valueChangeListener type="org.openuss.web.upload.UploadListener" />
		  			</t:inputFileUpload>
				  	<h:message for="image" styleClass="fieldError" showDetail="true" showSummary="false"/>
				</h:panelGroup>
			</h:panelGrid>
		<!-- user portrait -->
			<br />
		  	<h:outputText value="#{msg.user_portrait}" styleClass="header_font_normal"/>
		  	<div class="content_iframe">
				<fck:editor value="#{user.portrait}" id="portraitEditor" toolbarSet="Portrait" width="100%"  height="200px">
					<f:converter converterId="xssFilter"/>
				</fck:editor>
			</div>
	</s:authorize>

</ui:composition>