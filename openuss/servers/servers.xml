<!-- ================================================================= -->
<!-- Script file for Apache Tomcat                         	           -->
<!-- Author Ingo DÃ¼ppe 		                                           -->
<!-- ================================================================= -->
<project name="ejosa :: servers :: tomcat" basedir="." default="tomcat.debug" >

	<!-- =================================================================== -->
	<!-- Global properties                    			           			 -->
	<!-- =================================================================== -->
	<property name="ejosa.home" value="./../" />
	<property file="tomcat.${user.name}.properties" />
	<property file="tomcat.properties" />

	<property name="tomcat.home" value="${ejosa.home}/servers/tomcat" />
	<property name="tomcat.base" value="${tomcat.home}"/>
	<property name="tomcat.logging.file" value="${tomcat.base}/conf/logging.properties"/>

	<path id="catalina.path">
		<fileset dir="${tomcat.home}/bin">
			<include name="*.jar" />
		</fileset>
		<fileset dir="${tomcat.home}/common">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${tomcat.home}/server/lib">
			<include name="*.jar" />
		</fileset>
	</path>
	
	<!-- =================================================================== -->
	<!-- Tomcat Task Definition						 				           	 -->
	<!-- =================================================================== -->
	<taskdef resource="org/apache/catalina/ant/catalina.tasks" classpathref="catalina.path" />
	
	<!-- =================================================================== -->
	<!-- Targets                 			           			 			 -->
	<!-- =================================================================== -->

	<target name="init">
	<!--
		<pathconvert property="dependencies.shared.classpath" refid="dependencies.classpath" dirsep="/" pathsep=",file:"/>
		
		<copy tofile="./conf/catalina.properties" file="./conf/catalina.template.properties" overwrite="true">
			<filterset>
				<filter token="GENERATION-WARNING" value="Attention: Autogenerated File! Do not modify this file manually. See catalina.properties.template" />
				<filter token="catalina.common.classpath" value="${catalina.common.classpath}"/>
				<filter token="catalina.shared.classpath" value="file:${dependencies.shared.classpath}"/>
			</filterset>
		</copy>
	-->	
	</target>

	<target name="tomcat.start" depends="init" description="start tomcat">
		<java jar="${tomcat.home}/bin/bootstrap.jar" fork="true">
			<sysproperty key="catalina.home" value="${tomcat.home}"/>
			<sysproperty key="catalina.base" value="${tomcat.base}"/>
			<arg line="start" />
		</java>
	</target>

	<target name="tomcat.stop" description="stop tomcat">
		<java jar="${tomcat.home}/bin/bootstrap.jar" fork="true">
			<sysproperty key="catalina.home" value="${tomcat.home}"/>
			<sysproperty key="catalina.base" value="${tomcat.base}"/>
			<arg line="stop" />
		</java>
	</target>

	<target name="tomcat.debug" depends="init" description="stop">
		<java jar="${tomcat.home}/bin/bootstrap.jar" classpathref="catalina.path" fork="true">
			<sysproperty key="catalina.home" value="${tomcat.home}"/>
			<sysproperty key="catalina.base" value="${tomcat.base}"/> 
<!--
			<jvmarg line="-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager"/>
			<jvmarg line="-Djava.util.logging.config.file=${tomcat.logging.file}"/>
-->
			<jvmarg line="-Xdebug" />
			<jvmarg line="-Xrunjdwp:transport=dt_socket,address=8787,server=y,suspend=n" />
		</java>
	</target>

</project>
