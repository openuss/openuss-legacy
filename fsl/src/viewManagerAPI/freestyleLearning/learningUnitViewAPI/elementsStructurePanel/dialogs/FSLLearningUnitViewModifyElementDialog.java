/* Generated by Freestyle Learning Group */

package freestyleLearning.learningUnitViewAPI.elementsStructurePanel.dialogs;

import java.awt.BorderLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.BorderFactory;
import javax.swing.JCheckBox;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;

import freestyleLearning.learningUnitViewAPI.FSLLearningUnitViewElement;
import freestyleLearning.learningUnitViewAPI.FSLLearningUnitViewElementsManager;
import freestyleLearning.learningUnitViewAPI.FSLLearningUnitViewManager;
import freestyleLearningGroup.independent.gui.FLGColumnLayout;
import freestyleLearningGroup.independent.gui.FLGDialogInputVerifier;
import freestyleLearningGroup.independent.gui.FLGOptionPane;
import freestyleLearningGroup.independent.util.FLGInternationalization;

public class FSLLearningUnitViewModifyElementDialog implements FLGDialogInputVerifier {
    private FLGInternationalization internationalization;
    private JPanel viewSpecificPaneContainer;
    private JPanel dialogContentComponent;
    private FSLLearningUnitViewNewAndModifyElementDialogViewSpecificPane viewSpecificPane;
    private JTextField textField_elementTitle;
    private JCheckBox checkBox_elementFolder;
    private String elementTitle;
    private boolean elementFolder;
    private FSLLearningUnitViewElement learningUnitViewElement;
    private FSLLearningUnitViewManager learningUnitViewManager;

    public FSLLearningUnitViewModifyElementDialog() {
        internationalization = new FLGInternationalization("freestyleLearning.learningUnitViewAPI.elementsStructurePanel.internationalization",
            FSLLearningUnitViewNewElementDialog.class.getClassLoader());
        buildIndependentUI();
    }

    public boolean showDialog(FSLLearningUnitViewManager learningUnitViewManager, FSLLearningUnitViewElementsManager elementsManager, String elementId,
        FSLLearningUnitViewNewAndModifyElementDialogViewSpecificPane viewSpecificPane) {
    		this.learningUnitViewManager = learningUnitViewManager;
            this.viewSpecificPane = viewSpecificPane;
            if (elementsManager != null) {
                this.learningUnitViewElement = elementsManager.getLearningUnitViewElement(elementId, false);
                if (learningUnitViewElement != null) {
                    buildDependentUI(learningUnitViewElement, viewSpecificPane);
                    int returnValue = FLGOptionPane.showConfirmDialog(this, dialogContentComponent,
                        internationalization.getString("dialog.modifyElement.title"),
                        FLGOptionPane.OK_CANCEL_OPTION, FLGOptionPane.PLAIN_MESSAGE);
                    if (returnValue == FLGOptionPane.OK_OPTION) {
                        elementTitle = textField_elementTitle.getText();
                        elementFolder = checkBox_elementFolder.isSelected();
                    }
                    return returnValue == FLGOptionPane.OK_OPTION;
                }
            }
            return false;
    }

    public String getElementTitle() {
        return elementTitle;
    }

    public boolean isElementFolder() {
        return elementFolder;
    }

    public String verifyInput() {
        String errorString = "";
        if (textField_elementTitle.getText().length() == 0) {
            errorString += internationalization.getString("label.elementTitle.title") + ": " +
                internationalization.getString("text.missingValue") + "\n";
        }
        if (viewSpecificPane != null) {
            String viewSpecificPaneErrorString = viewSpecificPane.verifyInput(learningUnitViewElement, null,
                checkBox_elementFolder.isSelected(), 0);
            if (viewSpecificPaneErrorString != null) errorString += viewSpecificPaneErrorString;
        }
        if (errorString.length() > 0) return errorString;
        else
            return null;
    }

    public void buildDependentUI(FSLLearningUnitViewElement learningUnitViewElement,
        FSLLearningUnitViewNewAndModifyElementDialogViewSpecificPane viewSpecificPane) {
            textField_elementTitle.setText(learningUnitViewElement.getTitle());
            checkBox_elementFolder.setSelected(learningUnitViewElement.getFolder());
            viewSpecificPaneContainer.removeAll();
            if (viewSpecificPane != null) {
                viewSpecificPane.setInputFieldsDefaults(learningUnitViewElement);
                viewSpecificPane.setEnabled(!learningUnitViewElement.getFolder());
                viewSpecificPaneContainer.add((JComponent)viewSpecificPane);
            }
            viewSpecificPaneContainer.revalidate();
    }

    private void buildIndependentUI() {
        dialogContentComponent = new JPanel(new BorderLayout());
        dialogContentComponent.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));
        JPanel mainElementInputPanel = new JPanel(new FLGColumnLayout());
        dialogContentComponent.add(mainElementInputPanel, BorderLayout.NORTH);
        textField_elementTitle = new JTextField(20);
        mainElementInputPanel.add(
            new JLabel(internationalization.getString("label.elementTitle.title")), FLGColumnLayout.LEFT);
        mainElementInputPanel.add(textField_elementTitle, FLGColumnLayout.LEFTEND);
        checkBox_elementFolder = new JCheckBox();
        checkBox_elementFolder.setSelected(true);
        checkBox_elementFolder.addActionListener(
            new ActionListener() {
                public void actionPerformed(ActionEvent e) {
                    if (viewSpecificPane != null) {
                        viewSpecificPane.setEnabled(!checkBox_elementFolder.isSelected());
                    }
                }
            });
        if(learningUnitViewManager != null) {
        	if (learningUnitViewManager.getFolderComponent()) {
        		mainElementInputPanel.add(new JLabel(internationalization.getString("label.elementFolder.title")), FLGColumnLayout.LEFT);
        		mainElementInputPanel.add(checkBox_elementFolder, FLGColumnLayout.LEFTEND);
        	}
        }
        viewSpecificPaneContainer = new JPanel(new BorderLayout());
        viewSpecificPaneContainer.setOpaque(false);
        dialogContentComponent.add(viewSpecificPaneContainer, BorderLayout.CENTER);
    }
}
