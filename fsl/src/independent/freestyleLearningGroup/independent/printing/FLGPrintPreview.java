/* Generated by Freestyle Learning Group */

package freestyleLearningGroup.independent.printing;

import java.awt.*;
import java.awt.event.*;
import java.io.*;
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.text.html.*;
import javax.swing.text.Document;
import java.util.*;
import java.awt.print.PageFormat;
import java.awt.print.Printable;
import java.awt.print.PrinterException;
import java.awt.print.PrinterJob;

import freestyleLearningGroup.independent.gui.*;
import freestyleLearning.learningUnitViewAPI.*;
import freestyleLearningGroup.independent.gui.*;
import freestyleLearningGroup.independent.util.*;

/**
 * FLGPrintPreview.java
 * class shows HTML documents in an JEditorPane
 * Created on 16.04.2004
 * @author  Carsten Fiedler
 * modified on 18.06.2004 by Carsten Fiedler
 **/
public class FLGPrintPreview extends JFrame { 
    private JEditorPane helpContentPane;
    private FLGInternationalization internationalization;
    private FLGTextButton3D buttonPrint;
    private FLGTextButton3D buttonCancel;
    private JEditorPane printPreviewPane;
    private FLGHtmlDocumentRenderer docRen;
    private PageFormat pFormat;
    private PrinterJob pJob;
    
    public FLGPrintPreview() {
        super("Print Preview");
        internationalization = new FLGInternationalization("freestyleLearningGroup.independent.printing.internationalization",
        FLGPrintPreview.class.getClassLoader());
        java.awt.Dimension screenDimension = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        int pos_x = (int)(screenDimension.width / 5. / 4);
        int pos_y = (int)(screenDimension.height / 5. / 4);
        setSize(screenDimension.width * 2 / 3, screenDimension.height * 4 / 5);
        setLocation((int)(screenDimension.width - getWidth()) / 2, (int)(screenDimension.height - getHeight()) / 2);
        printPreviewPane = new JEditorPane();
        printPreviewPane.setEditable(false);
        JScrollPane scrollPane = new JScrollPane(printPreviewPane, JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,
        JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
        scrollPane.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
        scrollPane.setOpaque(false);
        JPanel helpButtonPanel = createButtonPanel();
        JPanel mainPanel = new FLGEffectPanel("FLGDialog.background", false);
        mainPanel.setLayout(new BorderLayout());
        mainPanel.setOpaque(false);
        mainPanel.add(scrollPane, BorderLayout.CENTER);
        mainPanel.add(helpButtonPanel, BorderLayout.SOUTH);
        getContentPane().add(mainPanel, BorderLayout.CENTER);
   }
    
    public void buildIndependentUI() {
        printPreviewPane = new JEditorPane();
        printPreviewPane.setEditable(false);
        JScrollPane scrollPane = new JScrollPane(printPreviewPane, JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,
        JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
        scrollPane.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
        scrollPane.setOpaque(false);
        JPanel helpButtonPanel = createButtonPanel();
        JPanel mainPanel = new FLGEffectPanel("FLGDialog.background", false);
        mainPanel.setLayout(new BorderLayout());
        mainPanel.setOpaque(false);
        mainPanel.setLayout(new BorderLayout());
        mainPanel.add(scrollPane, BorderLayout.CENTER);
        mainPanel.add(helpButtonPanel, BorderLayout.SOUTH);
        getContentPane().add(mainPanel, BorderLayout.CENTER);
    }
    
    private JPanel createButtonPanel() {
        JPanel buttonPanel = new FLGEffectPanel("FLGDialog.background", false);
        buttonPanel.setOpaque(false);
        
        buttonCancel = new FLGTextButton3D(internationalization.getString("button.cancel.label"),
        (Color)UIManager.get("FLGDialog.background"));
        buttonCancel.addActionListener(
        new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                setVisible(false);
            }
        });
        
        buttonCancel.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW).put(KeyStroke.getKeyStroke("ESCAPE"), "cancel");
        buttonCancel.getActionMap().put("cancel",
        new AbstractAction() {
            public void actionPerformed(ActionEvent e) {
                setVisible(false);
            }
        });
        
        buttonPrint = new FLGTextButton3D(internationalization.getString("button.print.label"),
        (Color)UIManager.get("FLGDialog.background"));
        buttonPrint.addActionListener(
        new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                System.out.println("Start printing..."); 
                docRen = new FLGHtmlDocumentRenderer();
                docRen.print(printPreviewPane);
                pFormat = new PageFormat();
                pJob = PrinterJob.getPrinterJob();
                if (pJob.printDialog()) {
                    pJob.setPrintable(docRen, pFormat);
                }
                try {
                    pJob.print();
                }
                catch (PrinterException printerException) {
                    System.out.println("Error Printing Document");
                }
                dispose();
            }
        });
        
        buttonPanel.add(buttonPrint);
        buttonPanel.add(buttonCancel);
        
        return buttonPanel;
    }
    
    public void setPane(JEditorPane combPane) {
        try {
            String documentType = combPane.getContentType();
            Document doc = (HTMLDocument)combPane.getDocument();
            printPreviewPane.setContentType("text/html");
            printPreviewPane.setDocument(doc);
            StyleSheet styleSheet = ((HTMLDocument)printPreviewPane.getDocument()).getStyleSheet();
            styleSheet.importStyleSheet(getClass().getClassLoader().getResource("freestyleLearningGroup/independent/printing/printStyleSheet.css"));
        } catch (Exception e) {
            System.out.println("Error while setting Print Preview!");
        }
    }
}
