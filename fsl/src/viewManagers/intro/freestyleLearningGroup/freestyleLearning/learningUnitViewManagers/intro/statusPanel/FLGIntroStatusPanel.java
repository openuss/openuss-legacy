/* Generated by Freestyle Learning Group */

package freestyleLearningGroup.freestyleLearning.learningUnitViewManagers.intro.statusPanel;

import java.text.DecimalFormat;

import freestyleLearning.learningUnitViewAPI.FSLLearningUnitViewManager;
import freestyleLearning.learningUnitViewAPI.events.learningUnitEvent.FSLLearningUnitEventGenerator;
import freestyleLearning.learningUnitViewAPI.events.learningUnitViewEvent.FSLLearningUnitViewAdapter;
import freestyleLearning.learningUnitViewAPI.events.learningUnitViewEvent.FSLLearningUnitViewEvent;
import freestyleLearning.learningUnitViewAPI.statusPanel.FSLAbstractLearningUnitViewStatusPanel;
import freestyleLearningGroup.freestyleLearning.learningUnitViewManagers.intro.data.xmlBindingSubclasses.FLGIntroElement;
import freestyleLearningGroup.freestyleLearning.learningUnitViewManagers.intro.events.learningUnitViewEvent.FLGIntroViewEvent;
import freestyleLearningGroup.independent.util.FLGInternationalization;

public class FLGIntroStatusPanel extends FSLAbstractLearningUnitViewStatusPanel {
    private FLGInternationalization internationalization;
    private int actualPlayingTime = 0;
    private int maximumPlayingTime = 0;
    private DecimalFormat minuteFormat = new DecimalFormat("00");
    private DecimalFormat secondsFormat = new DecimalFormat("':'00");

    public FLGIntroStatusPanel() {
        internationalization = new FLGInternationalization("freestyleLearningGroup.freestyleLearning.learningUnitViewManagers.intro.statusPanel.internationalization",
            getClass().getClassLoader());
    }

    public void init(FSLLearningUnitViewManager learningUnitViewManager,
        FSLLearningUnitEventGenerator learningUnitEventGenerator, boolean editMode) {
            super.init(learningUnitViewManager, learningUnitEventGenerator, editMode);
            learningUnitViewManager.addLearningUnitViewListener(new FLGIntroStatusPanel_LearningUnitViewAdapter());
    }

    public void buildDependentUI() {
        if (activeLearningUnitViewElementId == null)
            setText(internationalization.getString("text.welcome"));
        else {
            setText(internationalization.getString("text.hint"));
        }
    }

    class FLGIntroStatusPanel_LearningUnitViewAdapter extends FSLLearningUnitViewAdapter {
        public void learningUnitViewSpecificEventOccurred(FSLLearningUnitViewEvent e) {
        	FLGIntroViewEvent introViewEvent = (FLGIntroViewEvent)e;
        	if (introViewEvent.getEventSpecificType() == FLGIntroViewEvent.INTRO_VIDEO_PLAYING_TIME_PROGRESS) {
	            int maxMin = (int)(introViewEvent.maximumVideoPlayingTime / 60);
	            int maxSeconds = (int)(introViewEvent.maximumVideoPlayingTime % 60);
	            int actualMin = (int)((introViewEvent.actualVideoPlayingTime+1) / 60);
	            int actualSeconds = (int)((introViewEvent.actualVideoPlayingTime+1) % 60);
	            setText(minuteFormat.format(actualMin) + secondsFormat.format(actualSeconds)
	            		+ " / " + minuteFormat.format(maxMin) + secondsFormat.format(maxSeconds));
        	}
            
            if (introViewEvent.getEventSpecificType() == FLGIntroViewEvent.INTRO_END_OF_VIDEO_REACHED) {
                setText(internationalization.getString("text.hint"));
            }
            if (introViewEvent.getEventSpecificType() == FLGIntroViewEvent.INTRO_STOP_BUTTON_PRESSED) {
                setText(internationalization.getString("text.hint"));
            }
        }

        public void learningUnitViewElementActivated(FSLLearningUnitViewEvent event) {
            FLGIntroElement learningUnitViewElement =
                (FLGIntroElement)learningUnitViewElementsManager.getLearningUnitViewElement(event.getActiveLearningUnitViewElementId(), false);
            if (learningUnitViewElement == null || learningUnitViewElement.getFolder()) {
                setText(internationalization.getString("text.welcome"));
            }
            else {
                setText(internationalization.getString("text.hint"));
            }
        }
    }
}
