/* Generated by Freestyle Learning Group */

package freestyleLearningGroup.freestyleLearning.learningUnitViewManagers.checkUp.statusPanel;

import freestyleLearning.learningUnitViewAPI.FSLLearningUnitViewManager;
import freestyleLearning.learningUnitViewAPI.events.learningUnitEvent.FSLLearningUnitEventGenerator;
import freestyleLearning.learningUnitViewAPI.events.learningUnitViewEvent.FSLLearningUnitViewAdapter;
import freestyleLearning.learningUnitViewAPI.events.learningUnitViewEvent.FSLLearningUnitViewEvent;
import freestyleLearning.learningUnitViewAPI.statusPanel.FSLAbstractLearningUnitViewStatusPanel;
import freestyleLearningGroup.freestyleLearning.learningUnitViewManagers.checkUp.events.learningUnitViewEvent.FLGCheckUpEvent;
import freestyleLearningGroup.independent.util.FLGInternationalization;

public class FLGCheckUpStatusPanel extends
		FSLAbstractLearningUnitViewStatusPanel {
	private FLGInternationalization internationalization;

	private boolean playModeRunning = false;

	private int noQuestions;

	private int currentQuestionNo;

	public FLGCheckUpStatusPanel() {
		internationalization = new FLGInternationalization(
				"freestyleLearningGroup.freestyleLearning.learningUnitViewManagers.checkUp.statusPanel.internationalization",
				getClass().getClassLoader());
	}

	public void init(FSLLearningUnitViewManager learningUnitViewManager,
			FSLLearningUnitEventGenerator learningUnitEventGenerator,
			boolean editMode) {
		super.init(learningUnitViewManager, learningUnitEventGenerator,
				editMode);
		learningUnitViewManager
				.addLearningUnitViewListener(new FLGCheckUpStatusPanel_LearningUnitViewAdapter());
	}

	public void buildDependentUI() {
		if (activeLearningUnitViewElementId == null) {
			setText(internationalization.getString("text.welcome"));
		} else if (!playModeRunning) {
			String text = internationalization.getString("text.page")
					+ " "
					+ (learningUnitViewElementsManager
							.getElementPositionInDepthFirstOrder(activeLearningUnitViewElementId) + 1)
					+ " " + internationalization.getString("text.of") + " "
					+ learningUnitViewElementsManager.size();
			setText(text);
		} else {
			String text = internationalization.getString("text.page") + " "
					+ currentQuestionNo + " "
					+ internationalization.getString("text.of") + " "
					+ noQuestions + " "
					+ internationalization.getString("text.playList");
			setText(text);
		}
	}

	class FLGCheckUpStatusPanel_LearningUnitViewAdapter extends
			FSLLearningUnitViewAdapter {
		public void learningUnitViewSpecificEventOccurred(
				FSLLearningUnitViewEvent event) {
			FLGCheckUpEvent checkUpEvent = (FLGCheckUpEvent) event;
			if (checkUpEvent.getEventSpecificType() == FLGCheckUpEvent.CHECKUP_NEXT_QUESTION_SELECTED) {
				currentQuestionNo = checkUpEvent.getCurrentQuestionNo();
				buildDependentUI();
			} else if (checkUpEvent.getEventSpecificType() == FLGCheckUpEvent.CHECKUP_PLAY_MODE_ENTERED) {
				playModeRunning = true;
				noQuestions = checkUpEvent.getNoQuestions();
				currentQuestionNo = 1;
			} else if (checkUpEvent.getEventSpecificType() == FLGCheckUpEvent.CHECKUP_PLAY_MODE_EXITED) {
				playModeRunning = false;
				currentQuestionNo = 0;
				buildDependentUI();
			}
		}
	}
}
